[![Review Assignment Due Date](https://classroom.github.com/assets/deadline-readme-button-22041afd0340ce965d47ae6ef1cefeee28c7c493a6346c4f15d667ab976d596c.svg)](https://classroom.github.com/a/rDA9xjOr)
# Практика 03: Створення та налаштування додатку з використанням Ansible

Метою завдання є створення Ansible ролі, яка автоматизує процес розгортання простого Flask-додатку на сервері з використанням Nginx як зворотного проксі та Systemd для керування сервісами.

## Підготовка середовища

### Встановлення та налаштування Python віртуального середовища (venv)

- Встановіть Python 3, якщо він ще не встановлений на вашій системі.
- Створіть віртуальне середовище командою:
  ```bash
  python3 -m venv venv
  ```
- Активуйте віртуальне середовище:
  ```bash
  source venv/bin/activate
  ```
### Встановлення Ansible

- Поки ви перебуваєте у віртуальному середовищі, встановіть Ansible за допомогою `pip`:
  ```bash
  pip install ansible
  ```
- Перевірте встановлення Ansible:
  ```bash
  ansible --version
  ```

## Опис проєкту

В директорії `roles` створено роль `practice` відповідно до стандартної структури Ansible ролі:

```
practice/
├── defaults/
│   └── main.yml
├── files/
├── handlers/
│   └── main.yml
├── meta/
│   └── main.yml
├── tasks/
│   └── main.yml
├── templates/
└── vars/
    └── main.yml
```

У файлі `defaults/main.yml` визначено значення за замовчуванням для змінних, таких як:

- `packages`
- `apt_cache_valid_time`
- `app_dir`
- `app_file`
- `app_port`

Всі вказані змінні необхідно використати при реалізації задач ролі.

Опціонально, у файлі `vars/main.yml` визначте додаткові змінні або перевизначте значення існуючих змінних.

> [!NOTE]
> Якщо ви змінете значення змінної `app_dir`, переконайтесь що відповідне значення змінено в файлі `cleanup.yml` в кореневій директорії.

Файл `site.yml` можна використати для запуску ролі локально за допомогою команди:

```bash
ansible-playbook site.yml
```

Файл `cleanup.yml` можна використати для видалення конфігурації, яку створила роль, з вашого компʼютера:

```bash
ansible-playbook cleanup.yml
```

## Завдання

Всі кроки по автоматизації ролі повинні бути реалізовані в `tasks/main.yml` .

Використовуйте відповідні модулі Ansible:
- `apt` для встановлення пакунків.
- `file` для створення директорій та встановлення прав доступу.
- `copy` та `template` для розміщення файлів додатку та конфігураційних файлів.
- `pip` для встановлення Python-залежностей у віртуальному середовищі.
- `systemd` для керування сервісами.

### Встановлення необхідних пакунків

- Використовуючи модуль `apt`, встановіть всі пакунки, збережені в змінній `packages`.
- Використайте змінну `apt_cache_valid_time` для визначення часу дійсності кешу `apt`.

### Налаштування Flask-додатку

- Створіть директорію для додатку, шлях до якої зберігається у змінній `app_dir`.
- Скопіюйте файл додатку `files/app.py` до директорії, шлях до якої зберігається у змінній `app_dir`.
  - При копіюванні повинно бути передбачено переіменування файлу програми на нову назву, яка зберігається у змінній `app_file`.
- Скопіюйте картинку `files/static/cat.gif` до піддиректорії `static` всередині директорії додатку, шлях до якої зберігається у змінній `app_dir`.

### Віртуальне середовище Python
- Створіть віртуальне середовище Python (`venv`) всередині директорії додатку (змінна `app_dir`) для ізоляції залежностей.
- Встановіть необхідні Python-пакети з файлу `files/requirements.txt` (попередьно скопіювавши його до директорії, шлях до якої зберігається у змінній `app_dir`).

> [!NOTE]
> Для правильної роботи Ansible модуля `pip` необхідно використати його опцію `virtualenv_command: /usr/bin/python3 -m venv`

### Створення systemd service unit для Flask-додатку
- Створіть шаблон файлу сервісу `templates/flask_app.service.j2` для systemd.
- Сервіс повинен:
  - Запускати Flask-додаток з використанням віртуального середовища.
  - Використовувати змінні для параметризації шляху до додатку та порту (`app_port`).
  - Автоматично перезапускатися у випадку збою.

> [!TIP]
> Додаток очікує, що значення порта для запуску буде передано через змінну оточення `PORT`

### Налаштування Nginx як зворотного проксі
- Створіть шаблон конфігураційного файлу `templates/nginx.conf.j2` для Nginx.
- Налаштуйте Nginx на:
  - Прослуховування порту 80.
  - Перенаправлення запитів до Flask-додатку, який працює на `localhost` та вказаному `app_port`.
- Використовуйте змінні для параметризації порту.

> [!TIP]
> Скопіювати оброблений за допомогою Ansible шаблон необхідно буде до директорії `/etc/nginx/sites-available/default`

### Використання handlers
- Додайте handlers (`handlers/main.yml`) для перезавантаження systemd та Nginx після змін у конфігураційних файлах.
